<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>templates/views/helpers/index.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/project.html">project</a></li>
                                <li><a href="../classes/research.html">research</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/project.html">project</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: templates/views/helpers/index.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var moment = require(&#x27;moment&#x27;);
var _ = require(&#x27;underscore&#x27;);
var hbs = require(&#x27;handlebars&#x27;);
var keystone = require(&#x27;keystone&#x27;);
var cloudinary = require(&#x27;cloudinary&#x27;);


// Declare Constants
var CLOUDINARY_HOST = &#x27;http://res.cloudinary.com&#x27;;

// Collection of templates to interpolate
var linkTemplate = _.template(&#x27;&lt;a href=&quot;&lt;%= url %&gt;&quot;&gt;&lt;%= text %&gt;&lt;/a&gt;&#x27;);
var scriptTemplate = _.template(&#x27;&lt;script src=&quot;&lt;%= src %&gt;&quot;&gt;&lt;/script&gt;&#x27;);
var cssLinkTemplate = _.template(&#x27;&lt;link href=&quot;&lt;%= href %&gt;&quot; rel=&quot;stylesheet&quot;&gt;&#x27;);
var cloudinaryUrlLimit = _.template(CLOUDINARY_HOST + &#x27;/&lt;%= cloudinaryUser %&gt;/image/upload/c_limit,f_auto,h_&lt;%= height %&gt;,w_&lt;%= width %&gt;/&lt;%= publicId %&gt;.jpg&#x27;);


module.exports = function() {
	
	var _helpers = {};
	
	/**
	 * Generic HBS Helpers
	 * ===================
	 */
	
	// standard hbs equality check, pass in two values from template
	// {{#ifeq keyToCheck data.myKey}} [requires an else blockin template regardless]
	_helpers.ifeq = function(a, b, options) {
		if (a == b) {
			return options.fn(this);
		} else {
			return options.inverse(this);
		}
	};
	
	/**
	 * Port of Ghost helpers to support cross-theming
	 * ==============================================
	 * 
	 * Also used in the default keystonejs-hbs theme
	 */
	
	// ### Date Helper
	// A port of the Ghost Date formatter similar to the keystonejs - jade interface
	//
	//
	// *Usage example:*
	// &#x60;{{date format=&#x27;MM YYYY}}&#x60;
	// &#x60;{{date publishedDate format=&#x27;MM YYYY&#x27;&#x60;
	//
	// Returns a string formatted date
	// By default if no date passed into helper than then a current-timestamp is used
	//
	// Options is the formatting and context check this.publishedDate
	// If it exists then it is formated, otherwise current timestamp returned
	
	_helpers.date = function(context, options) {
		if (!options &amp;&amp; context.hasOwnProperty(&#x27;hash&#x27;)) {
			options = context;
			context = undefined;
			
			if (this.publishedDate) {
				context = this.publishedDate;
			}
		}
		
		// ensure that context is undefined, not null, as that can cause errors
		context = context === null ? undefined : context;
		
		var f = options.hash.format || &#x27;MMM Do, YYYY&#x27;,
			timeago = options.hash.timeago,
			date;
		
		// if context is undefined and given to moment then current timestamp is given
		// nice if you just want the current year to define in a tmpl
		if (timeago) {
			date = moment(context).fromNow();
		} else {
			date = moment(context).format(f);
		}
		return date;
	};
	
	// ### Category Helper
	// Ghost uses Tags and Keystone uses Categories
	// Supports same interface, just different name/semantics
	//
	// *Usage example:*
	// &#x60;{{categoryList categories separator=&#x27; - &#x27; prefix=&#x27;Filed under &#x27;}}&#x60;
	//
	// Returns an html-string of the categories on the post.
	// By default, categories are separated by commas.
	// input. categories:[&#x27;tech&#x27;, &#x27;js&#x27;]
	// output. &#x27;Filed Undder &lt;a href=&quot;blog/tech&quot;&gt;tech&lt;/a&gt;, &lt;a href=&quot;blog/js&quot;&gt;js&lt;/a&gt;&#x27;
	
	_helpers.categoryList = function(categories, options) {
		var autolink = _.isString(options.hash.autolink) &amp;&amp; options.hash.autolink === &quot;false&quot; ? false : true,
			separator = _.isString(options.hash.separator) ? options.hash.separator : &#x27;, &#x27;,
			prefix = _.isString(options.hash.prefix) ? options.hash.prefix : &#x27;&#x27;,
			suffix = _.isString(options.hash.suffix) ? options.hash.suffix : &#x27;&#x27;,
			output = &#x27;&#x27;;
		
		function createTagList(tags) {
			var tagNames = _.pluck(tags, &#x27;name&#x27;);
			
			if (autolink) {
				return _.map(tags, function(tag) {
					return linkTemplate({
						url: (&#x27;/blog/&#x27; + tag.key),
						text: _.escape(tag.name)
					});
				}).join(separator);
			}
			return _.escape(tagNames.join(separator));
		}
		
		if (categories &amp;&amp; categories.length) {
			output = prefix + createTagList(categories) + suffix;
		}
		return new hbs.SafeString(output);
	};
	
	/* To Implement [Ghost Helpers](http://docs.ghost.org/themes/#helpers)
	 * The [source](https://github.com/TryGhost/Ghost/blob/master/core/server/helpers/index.js)
	 *
	 * * &#x60;Foreach&#x60; Extended Helper
	 * * &#x60;Asset&#x60; Helper
	 * * &#x60;Content&#x60; Helper
	 * * &#x60;Excerpt&#x60; Helper
	 * * &#x60;Has&#x60; Helper
	 * * &#x60;Encode&#x60; Helper
	 * * Pagination
	 * * BodyClass
	 * * PostClass
	 * * meta_title
	 * * meta_description
	 * * ghost_[footer/header]
	 *
	 */
	
	/**
	 * KeystoneJS specific helpers
	 * ===========================
	 */
	
	// block rendering for keystone admin css
	_helpers.isAdminEditorCSS = function(user, options) {
		var output = &#x27;&#x27;;
		if (typeof(user) !== &#x27;undefined&#x27; &amp;&amp; user.isAdmin) {
			output = cssLinkTemplate({
				href: &quot;/keystone/styles/content/editor.min.css&quot;
			});
		}
		return new hbs.SafeString(output);
	};
	
	// block rendering for keystone admin js
	_helpers.isAdminEditorJS = function(user, options) {
		var output = &#x27;&#x27;;
		if (typeof(user) !== &#x27;undefined&#x27; &amp;&amp; user.isAdmin) {
			output = scriptTemplate({
				src: &#x27;/keystone/js/content/editor.js&#x27;
			});
		}
		return new hbs.SafeString(output);
	};
	
	// Used to generate the link for the admin edit post button
	_helpers.adminEditableUrl = function(user, options) {
		var rtn = keystone.app.locals.editable(user, {
			&#x27;list&#x27;: &#x27;Post&#x27;,
			&#x27;id&#x27;: options
		});
		return rtn;
	};
	
	// ### CloudinaryUrl Helper
	// Direct support of the cloudinary.url method from Handlebars (see
	// cloudinary package documentation for more details).
	//
	// *Usage examples:*
	// &#x60;{{{cloudinaryUrl image width=640 height=480 crop=&#x27;fill&#x27; gravity=&#x27;north&#x27;}}}&#x60;
	// &#x60;{{#each images}} {{cloudinaryUrl width=640 height=480}} {{/each}}&#x60;
	//
	// Returns an src-string for a cloudinary image
	
	_helpers.cloudinaryUrl = function(context, options) {

		// if we dont pass in a context and just kwargs
		// then &#x60;this&#x60; refers to our default scope block and kwargs
		// are stored in context.hash
		if (!options &amp;&amp; context.hasOwnProperty(&#x27;hash&#x27;)) {
			// strategy is to place context kwargs into options
			options = context;
			// bind our default inherited scope into context
			context = this;
		}
		
		// safe guard to ensure context is never null
		context = context === null ? undefined : context;
		
		if ((context) &amp;&amp; (context.public_id)) {
			var imageName = context.public_id.concat(&#x27;.&#x27;,context.format);
			return cloudinary.url(imageName, options.hash);
		}
		else {
			return null;
		}		
	};
	
	// ### Content Url Helpers
	// KeystoneJS url handling so that the routes are in one place for easier
	// editing.  Should look at Django/Ghost which has an object layer to access
	// the routes by keynames to reduce the maintenance of changing urls
	
	// Direct url link to a specific post
	_helpers.postUrl = function(postSlug, options) {
		return (&#x27;/blog/post/&#x27; + postSlug);
	};
	
	// might be a ghost helper
	// used for pagination urls on blog
	_helpers.pageUrl = function(pageNumber, options) {
		return &#x27;/blog?page=&#x27; + pageNumber;
	};
	
	// create the category url for a blog-category page
	_helpers.categoryUrl = function(categorySlug, options) {
		return (&#x27;/blog/&#x27; + categorySlug);
	};
	
	// ### Pagination Helpers
	// These are helpers used in rendering a pagination system for content
	// Mostly generalized and with a small adjust to &#x60;_helper.pageUrl&#x60; could be universal for content types
	
	/*
	* expecting the data.posts context or an object literal that has &#x60;previous&#x60; and &#x60;next&#x60; properties
	* ifBlock helpers in hbs - http://stackoverflow.com/questions/8554517/handlerbars-js-using-an-helper-function-in-a-if-statement
	* */
	_helpers.ifHasPagination = function(postContext, options){
		// if implementor fails to scope properly or has an empty data set
		// better to display else block than throw an exception for undefined
		if(_.isUndefined(postContext)){
			return options.inverse(this);
		}
		if(postContext.next || postContext.previous){
			return options.fn(this);
		}
		return options.inverse(this);
	};
	
	_helpers.paginationNavigation = function(pages, currentPage, totalPages, options){
		var html = &#x27;&#x27;;
		
		// pages should be an array ex.  [1,2,3,4,5,6,7,8,9,10, &#x27;....&#x27;]
		// &#x27;...&#x27; will be added by keystone if the pages exceed 10
		_.each(pages, function(page, ctr){
			// create ref to page, so that &#x27;...&#x27; is displayed as text even though int value is required
			var pageText = page,
			// create boolean flag state if currentPage
			isActivePage = ((page === currentPage)? true:false),
			// need an active class indicator
			liClass = ((isActivePage)? &#x27; class=&quot;active&quot;&#x27;:&#x27;&#x27;);

			// if &#x27;...&#x27; is sent from keystone then we need to override the url
			if(page === &#x27;...&#x27;){
				// check position of &#x27;...&#x27; if 0 then return page 1, otherwise use totalPages
				page = ((ctr)? totalPages:1);
			}

			// get the pageUrl using the integer value
			var pageUrl = _helpers.pageUrl(page);
			// wrapup the html
			html += &#x27;&lt;li&#x27;+liClass+&#x27;&gt;&#x27;+ linkTemplate({url:pageUrl,text:pageText})+&#x27;&lt;/li&gt;\n&#x27;;
		});
		return html;
	};

        // special helper to ensure that we always have a valid page url set even if
        // the link is disabled, will default to page 1
        _helpers.paginationPreviousUrl = function(previousPage, totalPages){
            if(previousPage === false){
                previousPage = 1;
            }
            return _helpers.pageUrl(previousPage);
        };

        // special helper to ensure that we always have a valid next page url set
        // even if the link is disabled, will default to totalPages
        _helpers.paginationNextUrl = function(nextPage, totalPages){
            if(nextPage === false){
                nextPage = totalPages;
            }
            return _helpers.pageUrl(nextPage);
        };


	//  ### Flash Message Helper
	//  KeystoneJS supports a message interface for information/errors to be passed from server
	//  to the front-end client and rendered in a html-block.  FlashMessage mirrors the Jade Mixin
	//  for creating the message.  But part of the logic is in the default.layout.  Decision was to
	//  surface more of the interface in the client html rather than abstracting behind a helper.
	//
	//  @messages:[]
	//
	//  *Usage example:*
	//  &#x60;{{#if messages.warning}}
	//      &lt;div class=&quot;alert alert-warning&quot;&gt;
	//          {{{flashMessages messages.warning}}}
	//      &lt;/div&gt;
	//   {{/if}}&#x60;
	
	_helpers.flashMessages = function(messages) {
		var output = &#x27;&#x27;;
		for (var i = 0; i &lt; messages.length; i++) {
			
			if (messages[i].title) {
				output += &#x27;&lt;h4&gt;&#x27; + messages[i].title + &#x27;&lt;/h4&gt;&#x27;;
			}
			
			if (messages[i].detail) {
				output += &#x27;&lt;p&gt;&#x27; + messages[i].detail + &#x27;&lt;/p&gt;&#x27;;
			}
			
			if (messages[i].list) {
				output += &#x27;&lt;ul&gt;&#x27;;
				for (var ctr = 0; ctr &lt; messages[i].list.length; ctr++) {
					output += &#x27;&lt;li&gt;&#x27; + messages[i].list[ctr] + &#x27;&lt;/li&gt;&#x27;;
				}
				output += &#x27;&lt;/ul&gt;&#x27;;
			}
		}
		return new hbs.SafeString(output);
	};


	//  ### underscoreMethod call + format helper
	//	Calls to the passed in underscore method of the object (Keystone Model)
	//	and returns the result of format() 
	//
	//  @obj: The Keystone Model on which to call the underscore method
	//	@undescoremethod: string - name of underscore method to call
	//
	//  *Usage example:*
	//  &#x60;{{underscoreFormat enquiry &#x27;enquiryType&#x27;}}
	
	_helpers.underscoreFormat = function (obj, underscoreMethod) {
		return obj._[underscoreMethod].format();
	}
	
	return _helpers;
};

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
